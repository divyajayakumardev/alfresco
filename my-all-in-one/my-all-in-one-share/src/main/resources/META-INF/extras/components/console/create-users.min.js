'use strict';if("undefined"==typeof Extras||!Extras)var Extras={};
(function(){var e=YAHOO.util.Dom,f=YAHOO.util.Event;Extras.ConsoleCreateUsers=function(b){this.name="Extras.ConsoleCreateUsers";Extras.ConsoleCreateUsers.superclass.constructor.call(this,b);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require("button container datasource datatable json history".split(" "),this.onComponentsLoaded,this);var a=this;FormPanelHandler=function(){FormPanelHandler.superclass.constructor.call(this,"form")};YAHOO.extend(FormPanelHandler,Alfresco.ConsolePanelHandler,
{onLoad:function(){a.widgets.userData=e.get(a.id+"-userdata");a.widgets.dataType=e.get(a.id+"-select-type");a.widgets.sendEmail=e.get(a.id+"-sendmail");a.widgets.helpLink=e.get(a.id+"-help-link");a.widgets.helpText=e.get(a.id+"-format-help");a.widgets.createButton=Alfresco.util.createYUIButton(a,"create-button",a.onCreateClick);YAHOO.util.Event.on(a.widgets.userData,"keyup",function(c){c.keyCode&&13==c.keyCode&&(c.ctrlKey||c.metaKey)&&!c.altKey&&(f.stopEvent(c),a.onCreateClick(c))},this);YAHOO.util.Event.on(a.widgets.helpLink,
"click",a.onHelpClick,a,!0)},onShow:function(){a.widgets.userData.focus()}});new FormPanelHandler;return this};YAHOO.extend(Extras.ConsoleCreateUsers,Alfresco.ConsoleTool,{options:{minSearchTermLength:1},onReady:function(){Extras.ConsoleCreateUsers.superclass.onReady.call(this)},onCreateClick:function(b,a){b=this.widgets.userData.value;this.widgets.createButton.set("disabled",!0);b={userdata:YAHOO.lang.trim(b),type:this.widgets.dataType.options[this.widgets.dataType.selectedIndex].value,sendmail:this.widgets.sendEmail.checked,
shareUri:window.location.protocol+"//"+window.location.host+Alfresco.constants.URL_CONTEXT};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"extras/slingshot/admin/create-users",method:Alfresco.util.Ajax.POST,dataObj:b,requestContentType:Alfresco.util.Ajax.JSON,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onCreateSuccess,scope:this},failureCallback:{fn:this.onCreateFailure,scope:this}})},onCreateSuccess:function(b){for(var a=[],c=[],d=0;d<b.json.users.length;d++)a.push(b.json.users[d].username);
for(d=0;d<b.json.skippedUsers.length;d++)c.push(b.json.skippedUsers[d].username);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.success",b.json.userCount,b.json.skippedUserCount)+(0<b.json.skippedUserCount?" ("+c.join(", ")+")":""),noEscape:!1});this.widgets.createButton.set("disabled",!1)},onCreateFailure:function(b){null!=b.json.message?Alfresco.util.PopupManager.displayPrompt({text:b.json.message}):Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.failure")});this.widgets.createButton.set("disabled",
!1)},onHelpClick:function(b,a){f.stopEvent(b);"none"==e.getStyle(this.widgets.helpText,"display")?Alfresco.util.Anim.fadeIn(this.widgets.helpText):Alfresco.util.Anim.fadeOut(this.widgets.helpText)}})})();
