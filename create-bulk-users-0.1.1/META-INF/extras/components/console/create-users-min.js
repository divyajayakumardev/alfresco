if(typeof Extras=="undefined"||!Extras){var Extras={};}(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event,Element=YAHOO.util.Element;var $html=Alfresco.util.encodeHTML;Extras.ConsoleCreateUsers=function(htmlId){this.name="Extras.ConsoleCreateUsers";Extras.ConsoleCreateUsers.superclass.constructor.call(this,htmlId);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datasource","datatable","json","history"],this.onComponentsLoaded,this);var parent=this;FormPanelHandler=function FormPanelHandler_constructor(){FormPanelHandler.superclass.constructor.call(this,"form");};YAHOO.extend(FormPanelHandler,Alfresco.ConsolePanelHandler,{onLoad:function onLoad(){parent.widgets.userData=Dom.get(parent.id+"-userdata");parent.widgets.dataType=Dom.get(parent.id+"-select-type");parent.widgets.sendEmail=Dom.get(parent.id+"-sendmail");parent.widgets.helpLink=Dom.get(parent.id+"-help-link");parent.widgets.helpText=Dom.get(parent.id+"-format-help");parent.widgets.createButton=Alfresco.util.createYUIButton(parent,"create-button",parent.onCreateClick);YAHOO.util.Event.on(parent.widgets.userData,"keyup",function(e){if(e.keyCode&&e.keyCode==13&&(e.ctrlKey||e.metaKey)&&!e.altKey){Event.stopEvent(e);parent.onCreateClick(e);}},this);YAHOO.util.Event.on(parent.widgets.helpLink,"click",parent.onHelpClick,parent,true);},onShow:function onShow(){parent.widgets.userData.focus();}});new FormPanelHandler();return this;};YAHOO.extend(Extras.ConsoleCreateUsers,Alfresco.ConsoleTool,{options:{minSearchTermLength:1},onReady:function ConsoleCreateUsers_onReady(){Extras.ConsoleCreateUsers.superclass.onReady.call(this);},onCreateClick:function ConsoleCreateUsers_onCreateClick(e,args){var userData=this.widgets.userData.value;this.widgets.createButton.set("disabled",true);var input={userdata:YAHOO.lang.trim(userData),type:this.widgets.dataType.options[this.widgets.dataType.selectedIndex].value,sendmail:this.widgets.sendEmail.checked,shareUri:window.location.protocol+"//"+window.location.host+Alfresco.constants.URL_CONTEXT};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"extras/slingshot/admin/create-users",method:Alfresco.util.Ajax.POST,dataObj:input,requestContentType:Alfresco.util.Ajax.JSON,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onCreateSuccess,scope:this},failureCallback:{fn:this.onCreateFailure,scope:this}});},onCreateSuccess:function ConsoleCreateUsers_onCreateSuccess(response){var userList=[];var skippedUserList=[];for(var i=0;i<response.json.users.length;i++){userList.push(response.json.users[i].username);}for(var i=0;i<response.json.skippedUsers.length;i++){skippedUserList.push(response.json.skippedUsers[i].username);}Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.success",response.json.userCount,response.json.skippedUserCount)+(response.json.skippedUserCount>0?" ("+skippedUserList.join(", ")+")":""),noEscape:false});this.widgets.createButton.set("disabled",false);},onCreateFailure:function ConsoleCreateUsers_onCreateFailure(response){if(response.json.message!=null){Alfresco.util.PopupManager.displayPrompt({text:response.json.message});}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.failure")});}this.widgets.createButton.set("disabled",false);},onHelpClick:function ConsoleCreateUsers_onHelpClick(e,args){Event.stopEvent(e);if(Dom.getStyle(this.widgets.helpText,"display")=="none"){Alfresco.util.Anim.fadeIn(this.widgets.helpText);}else{Alfresco.util.Anim.fadeOut(this.widgets.helpText);}}});})();